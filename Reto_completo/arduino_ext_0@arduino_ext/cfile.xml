<?xml version='1.0' encoding='utf-8'?>
<CFile xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  <variables>
    <variable name="Servo1_ON" type="BOOL"/>
    <variable name="Servo2_ON" type="BOOL"/>
    <variable name="Servo3_ON" type="BOOL"/>
    <variable name="Servo4_ON" type="BOOL"/>
  </variables>
  <sketch>
    <xhtml:p><![CDATA[
#include <Servo.h>
#include <Adafruit_TCS34725.h>

// Inicializaci\xf3n del sensor de color
Adafruit_TCS34725 tcs = Adafruit_TCS34725(TCS34725_INTEGRATIONTIME_50MS, TCS34725_GAIN_4X);

// Inicializaci\xf3n de los servos
Servo myservo1;
Servo myservo2;

// Definimos los \xe1ngulos para los servos
const int Angulo1 = 50; // 38, 47 El 50 es el bueno, no le vayas a mover
const int Angulo2 = 90;
const int Angulo3 = 135; //138


// Declaraci\xf3n de variables globales
bool F1 = 0, F2 = 0, F3 = 0, F4 = 0;   // Flags para colores

void sketch_setup() {
    // Inicializaci\xf3n del sensor de color
    if (!tcs.begin()) {
        Serial.println("Sensor TCS34725 no detectado.");
        while (1); // Detener ejecuci\xf3n si no hay sensor
    }
    
    // Configuraci\xf3n de los servos
    myservo1.attach(15);
    myservo1.write(90); // Posici\xf3n inicial
    myservo2.attach(16);
    myservo2.write(90); // Posici\xf3n inicial
    
    Serial.begin(9600); // Iniciar comunicaci\xf3n serial
}

void sketch_loop() {
    // Lectura de valores RGB
    float red, green, blue;
    tcs.getRGB(&red, &green, &blue);
    int R = int(red);
    int G = int(green);
    int B = int(blue);
    String color = "Neutral";

    // Detecci\xf3n del color y asignaci\xf3n de flags
    if ((R - G > 10) && (G - B > 60)) { // Amarillo
        color = "Amarillo";
        F1 = 1; F2 = 0; F3 = 0; F4 = 0;
    } else if ((G - R > 20) && (G - B > 50)) { // Verde
        color = "Verde";
        F1 = 0; F2 = 1; F3 = 0; F4 = 0;
    } else if ((G - R > 10) && (B - G > 20)) { // Azul
        color = "Azul";
        F1 = 0; F2 = 0; F3 = 1; F4 = 0;
    } else { // Neutral
        F1 = 0; F2 = 0; F3 = 0; F4 = 1;
    }

    // Imprimir valores para depuraci\xf3n
    Serial.print("R: "); Serial.print(R);
    Serial.print(" G: "); Serial.print(G);
    Serial.print(" B: "); Serial.print(B);
    Serial.print(" Color: "); Serial.println(color);

    // Control de los servos seg\xfan el flag activo
    if (F1 && Servo1_ON) { // Amarillo
        myservo1.write(Angulo1);
        myservo2.write(Angulo1-10);
    } else if (F2 && Servo1_ON) { // Verde
        myservo1.write(Angulo2);
        myservo2.write(Angulo2);
    } else if (F3 && Servo1_ON) { // Azul
        myservo1.write(Angulo3);
        myservo2.write(Angulo3);
    } else if (F4 && !Servo1_ON) { // Neutral
        myservo1.write(90); // Posici\xf3n central
        myservo2.write(90);
    }

    // Peque\xf1a pausa para estabilidad
    delay(100);
}
]]></xhtml:p>
  </sketch>
</CFile>
